<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCM Clinical Decision Support System</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>TCM Clinical Decision Support System</h1>
            <div class="header-actions">
                <span id="current-patient-name"></span>
                <button id="btn-home" class="btn btn-secondary">Home</button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="app-main">
            <!-- Home Screen -->
            <div id="screen-home" class="screen active">
                <div class="welcome-card">
                    <h2>Welcome to TCM CDSS</h2>
                    <p>Clinical Decision Support System for Traditional Chinese Medicine</p>
                    <p><strong>Modules Available: 1. Observation | 2. Interrogation</strong></p>
                    
                    <div class="action-buttons">
                        <button id="btn-new-patient" class="btn btn-primary btn-large">
                            <span class="btn-icon">+</span> New Patient
                        </button>
                        <button id="btn-existing-patient" class="btn btn-secondary btn-large">
                            <span class="btn-icon">üìã</span> Existing Patient
                        </button>
                    </div>
                </div>

                <div class="patients-list" id="patients-list" style="display: none;">
                    <h3>Recent Patients</h3>
                    <div id="patients-container"></div>
                </div>
            </div>

            <!-- New Patient Screen -->
            <div id="screen-new-patient" class="screen">
                <div class="form-card">
                    <h2>New Patient Registration</h2>
                    <form id="form-new-patient">
                        <div class="form-group">
                            <label for="patient-name">Patient Name *</label>
                            <input type="text" id="patient-name" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patient-dob">Date of Birth</label>
                                <input type="date" id="patient-dob">
                            </div>
                            <div class="form-group">
                                <label for="patient-gender">Gender</label>
                                <select id="patient-gender">
                                    <option value="">Select...</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patient-phone">Phone</label>
                                <input type="tel" id="patient-phone">
                            </div>
                            <div class="form-group">
                                <label for="patient-email">Email</label>
                                <input type="email" id="patient-email">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="chief-complaint">Chief Complaint</label>
                            <textarea id="chief-complaint" rows="3"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" id="btn-cancel-patient" class="btn btn-secondary">Cancel</button>
                            <button type="submit" class="btn btn-primary">Create Patient & Start Diagnostic</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Module Selection Screen -->
            <div id="screen-module-select" class="screen">
                <div class="form-card">
                    <h2>Select Diagnostic Module</h2>
                    <p class="module-instruction">Choose which diagnostic method to begin with. You can complete modules in any order.</p>
                    
                    <div class="module-cards">
                        <div class="module-card" onclick="app.startModule('chief-complaint')">
                            <div class="module-icon">üìã</div>
                            <h3>Chief Complaint Assessment</h3>
                            <p>Western diagnoses, primary concerns, and recent symptoms</p>
                            <div class="module-status" id="status-chief-complaint">Not Started</div>
                        </div>

                        <div class="module-card" onclick="app.startModule('observation')">
                            <div class="module-icon">üëÅÔ∏è</div>
                            <h3>Module 1: Observation (Êúõ W√†ng)</h3>
                            <p>Visual examination of patient's physical appearance, spirit, tongue, and body features</p>
                            <div class="module-status" id="status-observation">Not Started</div>
                        </div>

                        <div class="module-card" onclick="app.startModule('interrogation')">
                            <div class="module-icon">üí¨</div>
                            <h3>Module 2: Interrogation (Âïè W√®n)</h3>
                            <p>Clinical interview covering the Ten Questions about symptoms and body functions</p>
                            <div class="module-status" id="status-interrogation">Not Started</div>
                        </div>

                        <div class="module-card module-disabled">
                            <div class="module-icon">üñêÔ∏è</div>
                            <h3>Module 3: Palpation (Âàá Qi√®)</h3>
                            <p>Pulse diagnosis and physical examination</p>
                            <div class="module-status">Coming Soon</div>
                        </div>

                        <div class="module-card module-disabled">
                            <div class="module-icon">üëÇ</div>
                            <h3>Module 4: Listening & Smelling (ËÅû W√©n)</h3>
                            <p>Assessment of voice, breathing, and body odor</p>
                            <div class="module-status">Coming Soon</div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button id="btn-view-analysis" class="btn btn-primary" style="display: none;">View Complete Analysis</button>
                        <button id="btn-cancel-module" class="btn btn-secondary">Back to Home</button>
                    </div>
                </div>
            </div>

            <!-- Chief Complaint Screen -->
            <div id="screen-chief-complaint" class="screen">
                <div class="form-card">
                    <h2>Chief Complaint Assessment</h2>
                    <p class="module-instruction">Comprehensive information about the patient's current condition and concerns.</p>
                    
                    <form id="form-chief-complaint">
                        <!-- Part A: Western Medical Conditions -->
                        <div class="form-section">
                            <h3>Part A: Western Medical Diagnoses</h3>
                            <p class="field-instruction">List any diagnosed health conditions from Western medicine (e.g., Type 2 Diabetes, Hypertension, IBS)</p>
                            <div class="form-group">
                                <label for="western-conditions">Diagnosed Conditions</label>
                                <textarea id="western-conditions" rows="3" placeholder="e.g., Type 2 Diabetes, Irritable Bowel Syndrome, Hypertension"></textarea>
                            </div>
                        </div>

                        <!-- Part B: Primary Concern -->
                        <div class="form-section">
                            <h3>Part B: Primary Concern / Main Complaint</h3>
                            <p class="field-instruction">What is the main reason for this visit? What concerns the patient most?</p>
                            <div class="form-group">
                                <label for="primary-concern">Primary Concern *</label>
                                <textarea id="primary-concern" rows="3" required placeholder="e.g., Chronic fatigue and digestive problems that have worsened over the past 6 months"></textarea>
                            </div>
                        </div>

                        <!-- Part C: Recent Associated Symptoms -->
                        <div class="form-section">
                            <h3>Part C: Associated Symptoms (Past 2-3 Months)</h3>
                            <p class="field-instruction">What other symptoms has the patient experienced recently? Include timing, frequency, and any patterns noticed.</p>
                            <div class="form-group">
                                <label for="recent-symptoms">Recent Symptoms</label>
                                <textarea id="recent-symptoms" rows="4" placeholder="e.g., Cold hands and feet (especially at night), loose stools 2-3 times daily, occasional headaches in the afternoon"></textarea>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" id="btn-cancel-chief-complaint" class="btn btn-secondary">Back</button>
                            <button type="submit" class="btn btn-primary">Save & Continue</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Observation Module Screen -->
            <div id="screen-observation" class="screen">
                <div class="observation-container">
                    <!-- Progress Header -->
                    <div class="progress-header">
                        <div class="progress-bar">
                            <div id="progress-fill-obs" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progress-percentage-obs">0%</span> Complete
                        </div>
                    </div>

                    <!-- Two Column Layout -->
                    <div class="two-column-layout">
                        <!-- Left: Observation Form -->
                        <div class="observation-form">
                            <div class="section-nav">
                                <h3>Module 1: Observation</h3>
                                <div id="section-buttons-obs" class="section-buttons"></div>
                            </div>

                            <div id="observation-content" class="observation-content">
                                <!-- Dynamic content loaded here -->
                            </div>

                            <div class="form-navigation">
                                <button id="btn-prev-section-obs" class="btn btn-secondary">‚Üê Previous</button>
                                <button id="btn-next-section-obs" class="btn btn-primary">Next ‚Üí</button>
                                <button id="btn-complete-observation" class="btn btn-success" style="display: none;">Complete Observation</button>
                            </div>
                        </div>

                        <!-- Right: Pattern Analysis -->
                        <div class="pattern-analysis">
                            <!-- TCM Profile Card -->
                            <div class="tcm-profile-card">
                                <h3>TCM Profile</h3>
                                <button id="btn-refresh-profile-obs" class="btn btn-sm btn-secondary" style="float: right; margin-top: -35px;">Refresh</button>
                                <div id="tcm-profile-obs" class="tcm-profile-content">
                                    <p class="tcm-profile-empty">Complete data collection to generate TCM profile</p>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <h3>Pattern Analysis (Live)</h3>
                                <div id="pattern-results"></div>
                            </div>

                            <div class="confidence-card">
                                <h4>Diagnostic Confidence</h4>
                                <div class="confidence-meter">
                                    <div id="confidence-fill" class="confidence-fill" style="width: 0%"></div>
                                </div>
                                <div id="confidence-text">0% - Insufficient data</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interrogation Module Screen -->
            <div id="screen-interrogation" class="screen">
                <div class="observation-container">
                    <!-- Progress Header -->
                    <div class="progress-header">
                        <div class="progress-bar">
                            <div id="progress-fill-int" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progress-percentage-int">0%</span> Complete
                        </div>
                    </div>

                    <!-- Two Column Layout -->
                    <div class="two-column-layout">
                        <!-- Left: Interrogation Form -->
                        <div class="observation-form">
                            <div class="section-nav">
                                <h3>Module 2: Interrogation (Ten Questions)</h3>
                                <div id="section-buttons-int" class="section-buttons"></div>
                            </div>

                            <div id="interrogation-content" class="observation-content">
                                <!-- Dynamic content loaded here -->
                            </div>

                            <div class="form-navigation">
                                <button id="btn-prev-section-int" class="btn btn-secondary">‚Üê Previous</button>
                                <button id="btn-next-section-int" class="btn btn-primary">Next ‚Üí</button>
                                <button id="btn-complete-interrogation" class="btn btn-success" style="display: none;">Complete Interrogation</button>
                            </div>
                        </div>

                        <!-- Right: Pattern Analysis -->
                        <div class="pattern-analysis">
                            <!-- TCM Profile Card -->
                            <div class="tcm-profile-card">
                                <h3>TCM Profile</h3>
                                <button id="btn-refresh-profile-int" class="btn btn-sm btn-secondary" style="float: right; margin-top: -35px;">Refresh</button>
                                <div id="tcm-profile-int" class="tcm-profile-content">
                                    <p class="tcm-profile-empty">Complete data collection to generate TCM profile</p>
                                </div>
                            </div>

                            <div class="analysis-card">
                                <h3>Pattern Analysis (Live)</h3>
                                <div id="pattern-results-int"></div>
                            </div>

                            <div class="confidence-card">
                                <h4>Diagnostic Confidence</h4>
                                <div class="confidence-meter">
                                    <div id="confidence-fill-int" class="confidence-fill" style="width: 0%"></div>
                                </div>
                                <div id="confidence-text-int">0% - Insufficient data</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="screen-results" class="screen">
                <div class="results-container">
                    <h2>Diagnostic Analysis Complete</h2>
                    <div id="final-results"></div>
                    <div class="form-actions">
                        <button id="btn-back-to-modules" class="btn btn-secondary">Back to Modules</button>
                        <button id="btn-new-visit" class="btn btn-primary">New Visit</button>
                        <button id="btn-export-pdf" class="btn btn-secondary">Export PDF</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <script src="js/api.js"></script>
    <script src="js/observation-sections.js"></script>
    <script src="js/interrogation-sections.js"></script>
    <script src="js/app.js"></script>
</body>
</html>